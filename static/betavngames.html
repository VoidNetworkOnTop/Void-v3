<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Void Games</title>
    
    <!-- Favicon -->
    <link rel="shortcut icon" href="./assets/favicon.png" type="image/png">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="/assets/css/styles.css">
    
    <!-- Scripts -->
    <script src="/config.js"></script>
    <script src="/global.js"></script>
    <script src="uv/uv.bundle.js"></script>
    <script src="uv/uv.config.js"></script>
    <script src="/assets/js/favicon-handler.js"></script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-814Y2X3KSF"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-814Y2X3KSF');
    </script>

    <style>
    body, html {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        background: #000;
        color: #fff;
        font-family: Arial, sans-serif;
        overflow: hidden;
    }

    .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 1rem;
        position: relative;
        z-index: 2;
    }

    .main-content {
        background: #000;
        border-radius: 10px;
        width: 80%;
        max-width: 1000px;
        min-height: 400px;
        display: flex;
        flex-direction: column;
        position: relative;
        padding: 2rem;
        box-shadow: 
            0 0 2px #fff,
            0 0 4px #fff,
            0 0 6px #fff,
            0 0 8px #fff,
            inset 0 0 2px rgba(255, 255, 255, 0.2);
        z-index: 3;
        text-align: center;
    }

    .main-content::before {
        content: '';
        position: absolute;
        inset: -1px;
        background: transparent;
        border-radius: 10px;
        z-index: -1;
        box-shadow: 
            0 0 15px #fff,
            0 0 30px rgba(255, 255, 255, 0.8),
            0 0 40px rgba(255, 255, 255, 0.6),
            0 0 50px rgba(255, 255, 255, 0.4);
        opacity: 0.5;
    }

    .site-title {
        font-size: 2.5rem;
        margin: 0 0 2rem 0;
        background: linear-gradient(45deg, #fff, #a0a0a0);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 3px;
    }

    @media (max-width: 768px) {
        .main-content {
            width: 95%;
            padding: 1rem;
        }
        
        .site-title {
            font-size: 2rem;
        }
    }

    /* Loading Styles */
    #loadingOverlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #000 0%, #1a1a1a 100%);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 999999;
        transition: opacity 1s ease-in-out;
    }

    #loadingContainer {
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 30px;
    }

    #loadingLogo {
        width: 250px;
        height: 250px;
        perspective: 1000px;
    }

    #loadingLogo img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        border-radius: 40px;
        box-shadow: 0 15px 35px rgba(255,255,255,0.2);
        animation: wave-and-float 2.5s ease-in-out infinite;
        transition: transform 0.3s ease;
    }

    #loadingText {
        color: #fff;
        font-size: 1.5rem;
        letter-spacing: 3px;
        font-weight: 300;
        opacity: 0.8;
    }

    .dots::after {
        content: '.';
        display: inline-block;
        animation: pulsing-dots 1.4s infinite;
    }

    #loadingBar {
        width: 400px;
        height: 10px;
        background-color: rgba(255,255,255,0.1);
        border-radius: 20px;
        overflow: hidden;
        position: relative;
    }

    #progressFill {
        width: 0;
        height: 100%;
        background: linear-gradient(
            90deg, 
            rgba(255,255,255,0.1) 0%, 
            rgba(255,255,255,0.5) 50%, 
            rgba(255,255,255,0.1) 100%
        );
        background-size: 200% 100%;
        animation: shimmer 1.5s infinite linear;
        transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes wave-and-float {
        0%, 100% { transform: translateY(0) rotate(-5deg); }
        50% { transform: translateY(-20px) rotate(5deg); }
    }

    @keyframes pulsing-dots {
        0%, 20% { content: '.'; }
        33%, 53% { content: '..'; }
        66%, 100% { content: '...'; }
    }

    @keyframes shimmer {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
    }

    .fade-out {
        opacity: 0;
        pointer-events: none;
    }
    </style>
</head>

<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=G-814Y2X3KSF"
            height="0" width="0" style="display:none;visibility:hidden">
        </iframe>
    </noscript>

    <!-- Header placeholder that will be loaded via JavaScript -->
    <div id="header"></div>
    
    <div class="container">
        <div class="main-content">
            <h1 class="site-title">The Void Games</h1>
        </div>
    </div>
    
    <!-- Footer placeholder that will be loaded via JavaScript -->
    <div id="footer"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay">
        <div id="loadingContainer">
            <div id="loadingLogo">
                <img src="https://lh7-us.googleusercontent.com/5Fbqj024fM1jyET0B-xC-r_j93ktHdB5dYlB80U7oxpfzefa3nFPjxwdbgE9LgwVN6URIpbowiYLJg376qRm2cPd3eD8h0ot8aeosM6xb2uZaWLIATnAah--MUM1RNliv8znm8Yv2VTfPR5n_1JpwzarFulfpQ" alt="Logo">
            </div>
            <div id="loadingText">Loading<span class="dots"></span></div>
            <div id="loadingBar">
                <div id="progressFill"></div>
            </div>
        </div>
    </div>

    <!-- Service Worker Registration -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const stockSW = "/uv/sw.js";
            const swScope = "/uv/"; 
            const swAllowedHostnames = ["localhost", "127.0.0.1"];
            
            // Function to preload and register the service worker with correct scope
            async function preloadServiceWorker() {
                // Check if service workers are supported
                if (!('serviceWorker' in navigator)) {
                    console.error("Service workers are not supported in this browser");
                    return false;
                }
                
                // Check if we're on HTTPS or allowed development hostnames
                if (location.protocol !== 'https:' && !swAllowedHostnames.includes(location.hostname)) {
                    console.warn("Service workers require HTTPS (except on localhost/127.0.0.1)");
                    return false;
                }
                
                try {
                    console.log('Registering UV service worker with scope:', swScope);
                    
                    // Register the service worker with the CORRECT scope
                    const registration = await navigator.serviceWorker.register(stockSW, { 
                        scope: swScope,
                        updateViaCache: 'none'
                    });
                    
                    // Wait for the service worker to be ready
                    await navigator.serviceWorker.ready;
                    
                    // If we have an active service worker, send it a message to skip waiting
                    if (registration.active) {
                        registration.active.postMessage({ type: 'SKIP_WAITING' });
                    }
                    
                    console.log('UV service worker successfully registered with scope:', registration.scope);
                    window.__uv$serviceWorkerRegistered = true;
                    return true;
                } catch (error) {
                    console.error('UV service worker registration failed:', error);
                    return false;
                }
            }
            
            // Start preloading the service worker immediately
            preloadServiceWorker();
        });
    </script>

    <!-- Loading Animation Script -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loadingOverlay = document.getElementById('loadingOverlay');
            const progressFill = document.getElementById('progressFill');
            
            // Progress animation
            function animateProgress() {
                let progress = 0;
                const maxProgress = 100;
                const speed = 0.5;

                function updateProgress() {
                    if (progress < maxProgress) {
                        progress += speed;
                        progressFill.style.width = `${Math.min(progress, maxProgress)}%`;
                        
                        if (progress < maxProgress) {
                            requestAnimationFrame(updateProgress);
                        } else {
                            // Final checks and removal
                            setTimeout(() => {
                                loadingOverlay.classList.add('fade-out');
                                loadingOverlay.addEventListener('transitionend', () => {
                                    loadingOverlay.remove();
                                });
                            }, 500);
                        }
                    }
                }

                // Ensure initial visibility
                progressFill.style.width = '1%';
                requestAnimationFrame(updateProgress);
            }

            // Ensure all critical resources are loaded
            function waitForCriticalResources() {
                const criticalChecks = [
                    () => window.CONFIG !== undefined,
                    () => window.loadHTML !== undefined,
                    () => window.__uv$config !== undefined
                ];

                function checkResources() {
                    const allLoaded = criticalChecks.every(check => check());
                    
                    if (allLoaded) {
                        animateProgress();
                    } else {
                        // If not loaded, check again after a short delay
                        setTimeout(checkResources, 100);
                    }
                }

                // Start initial check with a timeout fallback
                checkResources();
                
                // Fallback timeout to prevent indefinite waiting
                setTimeout(() => {
                    animateProgress();
                }, 5000);
            }

            // Kick off the loading process
            waitForCriticalResources();

            // Ensure loading bar is visible even if resources are cached
            window.addEventListener('load', () => {
                if (loadingOverlay && !loadingOverlay.classList.contains('fade-out')) {
                    animateProgress();
                }
            });
        });
    </script>

    <!-- Header and Footer Loading Script -->
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Wait for the global loadHTML function to be available
            await new Promise(resolve => {
                if (window.loadHTML) {
                    resolve();
                } else {
                    const checkLoadHTML = setInterval(() => {
                        if (window.loadHTML) {
                            clearInterval(checkLoadHTML);
                            resolve();
                        }
                    }, 100);
                }
            });

            // Load the header and footer
            loadHTML("/assets/html/header.html", "header");
            loadHTML("/assets/html/footer.html", "footer");
        });
    </script>
</body>
</html>
